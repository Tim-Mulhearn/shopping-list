<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/x-icon" href="fav-icon.ico">
  <title>Shopping list</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="styles/styles.css" />
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
<main id="app">
  <div class="flex-container">
    <!-- CURRENT LIST -->
    <div class="shop-list">
      <h2>Shopping List</h2>

      <div class="shop-list-input-row">
        <input
          type="text"
          class="shop-list-add-item"
          placeholder="Add an item"
          v-model="itemName"
          @keyup.enter="addItem"
        />
        <button class="btn btn-add" @click="addItem">Add Item</button>
      </div>

      <div class="saved-list-empty" v-if="shoppingList.length === 0">
        <p>Shopping list is empty</p>
      </div>

      <div class="shop-list-item-row" v-for="(item, index) in shoppingList" :key="item.name">
        <span>{{ item.name }}</span>
        <button class="btn btn-remove" @click="removeItem(index)">Remove</button>
      </div>

      <div class="shop-list-buttons" v-if="shoppingList.length > 0">
        <template v-if="updateList">
          <button class="btn btn-save" @click="updateShoppinglist">Update</button>
          <button class="btn btn-delete" @click="cancelUpdate">Cancel</button>
        </template>
        <template v-else>
          <button class="btn btn-save" @click="openModal(null, 'saveModal')">Save</button>
          <button class="btn btn-delete" @click="clearList">Clear</button>
        </template>
      </div>
    </div>

    <!-- SAVED LISTS -->
    <div class="saved-list">
      <h2>Saved Lists</h2>

      <div class="saved-list-empty" v-if="Object.keys(savedLists).length === 0">
        <p>You donâ€™t have any saved lists</p>
      </div>

      <div class="saved-list-item-row" v-for="(list, key) in savedLists" :key="key">
        <span>{{ key }} ({{ list.length }} items)</span>
        <div class="save-list-buttons">
          <button class="btn btn-edit" @click="loadList(key)">Edit/View</button>
          <button class="btn btn-delete" @click="openModal(key, 'deleteModal')">Delete</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODALS -->
  <div class="modal-background" v-if="showModal" @click.self="closeModal">
    <div class="modal-delete" v-if="showModalDelete">
      <div class="modal-text">
        <div>Do you want to delete the list?</div>
      </div>
      <div class="modal-buttons">
        <button class="btn btn-delete" @click="deleteList(modalValue)">Delete</button>
        <button class="btn btn-edit" @click="closeModal">Cancel</button>
      </div>
    </div>

    <div class="modal-save" v-if="showModalSave">
      <div class="modal-text">
        <div>Enter a name for the list</div>
        <input
          type="text"
          class="shop-list-save-list"
          placeholder="Shopping list name"
          v-model="shoppingListName"
          @keyup.enter="saveShoppinglist"
        />
      </div>
      <div class="modal-buttons">
        <button class="btn btn-edit" @click="saveShoppinglist">Save</button>
        <button class="btn btn-delete" @click="closeModal">Cancel</button>
      </div>
    </div>
  </div>
</main>

<script>
  const { createApp, ref, onMounted } = Vue;

  createApp({
    setup() {
      // Vars.
      const itemName = ref('');
      const shoppingList = ref([]);
      const savedLists = ref({});
      const showModal = ref(false);
      const showModalDelete = ref(false);
      const showModalSave = ref(false);
      const modalValue = ref('');
      const shoppingListName = ref('');
      const updateList = ref(false);
      const updateListKey = ref('');

      // On mount, get saved lists.
      onMounted(() => {
        const saved = localStorage.getItem('shoppingListSavedList');
        if (saved) {
          try { savedLists.value = JSON.parse(saved) || {}; }
          catch { savedLists.value = {}; }
        }
      });

      // Add item.
      function addItem() {
        const v = itemName.value.trim();
        if (!v) return;
        shoppingList.value.push({ name: v });
        itemName.value = '';
      }

      // Remove item.
      function removeItem(index) {
        shoppingList.value.splice(index, 1);
      }

      // Reset list.
      function clearList() {
        shoppingList.value = [];
      }

      // Save list.
      function saveShoppinglist() {
        const name = shoppingListName.value.trim();
        if (!name || shoppingList.value.length === 0) return;

        savedLists.value[name] = [...shoppingList.value];
        localStorage.setItem('shoppingListSavedList', JSON.stringify(savedLists.value));

        shoppingList.value = [];
        shoppingListName.value = '';
        closeModal();
      }

      // Update list.
      function updateShoppinglist() {
        const key = updateListKey.value;

        if (!updateList.value || !key) return;
        if (!Array.isArray(shoppingList.value) || shoppingList.value.length === 0) return;
        if (!Object.prototype.hasOwnProperty.call(savedLists.value, key)) return;

        savedLists.value[key] = [...shoppingList.value];
        localStorage.setItem('shoppingListSavedList', JSON.stringify(savedLists.value));

        updateList.value = false;
        updateListKey.value = '';
        shoppingListName.value = '';
        shoppingList.value = [];
      }

      // Cancel update.
      function cancelUpdate() {
        updateList.value = false;
        updateListKey.value = '';
        shoppingList.value = [];
      }

      // Load list.
      function loadList(key) {
        const list = savedLists.value[key];

        if (Array.isArray(list)) {
          shoppingList.value = [...list];
          updateList.value = true;
          updateListKey.value = key;
          shoppingListName.value = key;
        }
      }

      // Delete list.
      function deleteList(key) {
        if (key in savedLists.value) {
          delete savedLists.value[key];
          localStorage.setItem('shoppingListSavedList', JSON.stringify(savedLists.value));
        }
        closeModal();
      }

      // Open modal.
      function openModal(payload, type) {
        showModalDelete.value = false;
        showModalSave.value = false;

        if (type === 'deleteModal') {
          modalValue.value = payload;
          showModalDelete.value = true;
        }
        else if (type === 'saveModal') {
          if (updateList.value && updateListKey.value) {
            shoppingListName.value = updateListKey.value;
          }
          modalValue.value = null;
          showModalSave.value = true;
        }

        showModal.value = true;
      }

      // Close modal.
      function closeModal() {
        showModal.value = false;
        showModalDelete.value = false;
        showModalSave.value = false;
        shoppingListName.value = '';
      }

      return {
        // States.
        itemName, shoppingList, savedLists,
        showModal, showModalDelete, showModalSave,
        modalValue, shoppingListName, updateList,
        // Actions.
        addItem, removeItem, clearList,cancelUpdate,
        saveShoppinglist, updateShoppinglist, loadList, deleteList,
        openModal, closeModal
      };
    }
  }).mount('#app');
</script>
</body>
</html>
